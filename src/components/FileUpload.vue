<template>
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header"></div>
          <div class="card-body">

            <form action="" method="POST" id="testForm">
              <div class="form-row">

                <div class="form-group col-sm-4">
                  <label for="customFile">相關檔案</label>
                  <div class="position-relative">
                    <button type="button" class="close closeImgBtn position-absolute closeImgBtn-position" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                    <img alt="" class="img-thumbnail round mb-3 img-fluid showImg" src="https://fakeimg.pl/610x226/?text=Choose%20file&font=museo">
                  </div>
                  <div class="custom-file">
                    <!-- <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="https://www.codeproject.com/KB/GDI-plus/ImageProcessing2/img.jpg"> -->
                    <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="">
                    <input type="file" class="custom-file-input" id="PositiveFile" name="PositiveFile">
                    <label class="custom-file-label" for="PositiveFile">請選擇...</label>
                  </div>
                </div>
                <div class="form-group col-sm-4">
                  <label for="customFile">相關檔案</label>
                  <div class="position-relative">
                    <button type="button" class="close closeImgBtn position-absolute closeImgBtn-position" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                    <img alt="" class="img-thumbnail round mb-3 img-fluid showImg" src="https://fakeimg.pl/610x226/?text=Choose%20file&font=museo">
                  </div>
                  <div class="custom-file">
                    <!-- <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="https://www.codeproject.com/KB/GDI-plus/ImageProcessing2/img.jpg"> -->
                    <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="">
                    <input type="file" class="custom-file-input" id="PositiveFile" name="PositiveFile">
                    <label class="custom-file-label" for="PositiveFile">請選擇...</label>
                  </div>
                </div>
                <div class="form-group col-sm-4">
                  <label for="customFile">相關檔案</label>
                  <div class="position-relative">
                    <button type="button" class="close closeImgBtn position-absolute closeImgBtn-position" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                    <img alt="" class="img-thumbnail round mb-3 img-fluid showImg" src="https://fakeimg.pl/610x226/?text=Choose%20file&font=museo">
                  </div>
                  <div class="custom-file">
                    <!-- <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="https://www.codeproject.com/KB/GDI-plus/ImageProcessing2/img.jpg"> -->
                    <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="">
                    <input type="file" class="custom-file-input" id="PositiveFile" name="PositiveFile">
                    <label class="custom-file-label" for="PositiveFile">請選擇...</label>
                  </div>
                </div>
                <div class="form-group col-sm-4">
                  <label for="customFile">相關檔案</label>
                  <div class="position-relative">
                    <button type="button" class="close closeImgBtn position-absolute closeImgBtn-position" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                    <img alt="" class="img-thumbnail round mb-3 img-fluid showImg" src="https://fakeimg.pl/610x226/?text=Choose%20file&font=museo">
                  </div>
                  <div class="custom-file">
                    <!-- <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="https://www.codeproject.com/KB/GDI-plus/ImageProcessing2/img.jpg"> -->
                    <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="">
                    <input type="file" class="custom-file-input" id="PositiveFile" name="PositiveFile">
                    <label class="custom-file-label" for="PositiveFile">請選擇...</label>
                  </div>
                </div>
                <div class="form-group col-sm-4">
                  <label for="customFile">相關檔案</label>
                  <div class="position-relative">
                    <button type="button" class="close closeImgBtn position-absolute closeImgBtn-position" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                    <img alt="" class="img-thumbnail round mb-3 img-fluid showImg" src="https://fakeimg.pl/610x226/?text=Choose%20file&font=museo">
                  </div>
                  <div class="custom-file">
                    <!-- <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="https://www.codeproject.com/KB/GDI-plus/ImageProcessing2/img.jpg"> -->
                    <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="">
                    <input type="file" class="custom-file-input" id="PositiveFile" name="PositiveFile">
                    <label class="custom-file-label" for="PositiveFile">請選擇...</label>
                  </div>
                </div>
                <div class="form-group col-sm-4">
                  <label for="customFile">相關檔案</label>
                  <div class="position-relative">
                    <button type="button" class="close closeImgBtn position-absolute closeImgBtn-position" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                    <img alt="" class="img-thumbnail round mb-3 img-fluid showImg" src="https://fakeimg.pl/610x226/?text=Choose%20file&font=museo">
                  </div>
                  <div class="custom-file">
                    <!-- <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="https://www.codeproject.com/KB/GDI-plus/ImageProcessing2/img.jpg"> -->
                    <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="">
                    <input type="file" class="custom-file-input" id="PositiveFile" name="PositiveFile">
                    <label class="custom-file-label" for="PositiveFile">請選擇...</label>
                  </div>
                </div>
                <div class="form-group col-sm-4">
                  <label for="customFile">相關檔案</label>
                  <div class="position-relative">
                    <button type="button" class="close closeImgBtn position-absolute closeImgBtn-position" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                    <img alt="" class="img-thumbnail round mb-3 img-fluid showImg" src="https://fakeimg.pl/610x226/?text=Choose%20file&font=museo">
                  </div>
                  <div class="custom-file">
                    <!-- <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="https://www.codeproject.com/KB/GDI-plus/ImageProcessing2/img.jpg"> -->
                    <input type="hidden" class="urlHidden" name="PositiveUrl" id="PositiveUrl" value="">
                    <input type="file" class="custom-file-input" id="PositiveFile" name="PositiveFile">
                    <label class="custom-file-label" for="PositiveFile">請選擇...</label>
                  </div>
                </div>

              </div>
              <button type="submit" class="btn btn-primary">送出</button>
            </form>

          </div>
          <div class="card-footer"></div>
        </div>
      </div>

      <!-- <div class="col-12 mt-4">
        <form id="form1" runat="server">
          <input type='file' id="imgInp" />
          <img id="target" src="#" alt="your image" />
        </form>
      </div> -->
    </div>
  </div>
</template>
<script>
export default {
  name: 'fileupload',
  created () { },
  mounted () {
    /* change picture url */
    (function () {
      $('.custom-file-input').on('change', function (e) {
        var self = e.target
        // 設定顯示路徑
        $(this).next().after().text($(this).val().split('\\').slice(-1)[0])

        // 設定圖片
        var showImgDom = self.parentElement.parentElement.getElementsByClassName('showImg')[0]

        if (this.files && this.files[0]) {
          var reader = new FileReader()
          reader.onload = function (e) {
            showImgDom.setAttribute('src', e.target.result)
          }

          reader.readAsDataURL(this.files[0])
        }
      })

      $('.closeImgBtn').on('click', function (e) {
        var self = e.target

        if (self.tagName === 'SPAN') {
          self = self.parentElement.parentElement
        }

        var parentNode = self.parentElement
        var customfileinputDom = parentNode.getElementsByClassName('custom-file-input')[0]
        var customfilelabelDom = parentNode.getElementsByClassName('custom-file-label')[0]
        var showImgDom = parentNode.getElementsByClassName('showImg')[0]
        // 此欄位Update才有
        var urlHiddenDom = parentNode.getElementsByClassName('urlHidden')[0]

        if (confirm('確認刪除?')) {
          if (urlHiddenDom) {
            urlHiddenDom.value = ''
          }
          customfileinputDom.value = ''
          customfilelabelDom.innerText = '請選擇...'
          showImgDom.setAttribute('src', 'https://fakeimg.pl/610x226/?text=Choose%20file&font=museo')
        }
      });

      // update view use，show Image
      (function ShowImg () {
        var urlHiddenDom = document.getElementsByClassName('urlHidden')
        for (var i = urlHiddenDom.length - 1; i > -1; i--) {
          var myValue = urlHiddenDom[i].value
          if (myValue !== '' && myValue !== 'undefined') {
            urlHiddenDom[i].parentElement.parentElement.getElementsByClassName('showImg')[0].setAttribute('src', myValue)
          }
        }
      }())
    }())

    document.getElementById('testForm').addEventListener('submit', function (e) {
      // console.log($(e.target).serialize())
      // console.log($(e.target).serializeArray())

      // e.preventDefault()
      // return false
    })
  }
}
</script>
<style lang="css" >
.custom-file-label {
  overflow: hidden;
}

.closeImgBtn {
  color: white;
  font-size: 16px;
  opacity: .35;
}

.closeImgBtn-position {
  transition: opacity 0.5s ease-out;
  top: -16px;
  right: -12px;
}

.closeImgBtn:hover,
.closeImgBtn:focus {
  background-color: transparent;
  /* border: 1px solid red; */
  border-radius: 50%;
  color: red;
}

.closeImgBtn:hover > span {
  /* background-color: #fff; */
  /* color: red; */
  opacity: 1;
  border-radius: 50%;


}

.closeImgBtn > span {
  display: inline-block;
  width: 21px;
  height: 21px;
  line-height: 18px;
  background-color: red;
  border-radius: 50%;
  color: #fff;
  /* border: 1px solid #fff; */
}
</style>
